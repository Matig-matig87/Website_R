import React, { useState, useEffect } from 'react';

const App = () => {
  // Simulating data that could come from an external source
  const [projects, setProjects] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [sortConfig, setSortConfig] = useState({ key: 'eloScore', direction: 'descending' });
  const [filterCategory, setFilterCategory] = useState('All');
  const [newProject, setNewProject] = useState({
    name: '',
    team: '',
    category: 'OS Project',
    complexity: 5.0,
    effectiveness: 5.0
  });

  // Categories for filtering
  const categories = ['All', 'OS Project', 'University', 'Corporate', 'Individual'];

  // In a real implementation, you would fetch this data from your Excel Online or other data source
  // This simulates loading data from an external source
  useEffect(() => {
    // Simulate API call to load data
    const loadProjects = async () => {
      setIsLoading(true);
      
      // This is where you would normally fetch from Excel Online, Google Sheets, or a database
      // For demo purposes, we're using mock data, but structured to be easily replaceable
      const mockData = [
        {
          id: 1,
          name: "React",
          team: "Meta",
          category: "Corporate",
          eloScore: 2850,
          dateAdded: "2024-01-15",
          complexity: 8.7,
          effectiveness: 9.2
        },
        {
          id: 2,
          name: "TensorFlow",
          team: "Google Brain",
          category: "Corporate",
          eloScore: 2780,
          dateAdded: "2024-01-12",
          complexity: 9.1,
          effectiveness: 8.5
        },
        {
          id: 3,
          name: "Linux Kernel",
          team: "Linux Foundation",
          category: "OS Project",
          eloScore: 2720,
          dateAdded: "2024-01-10",
          complexity: 9.5,
          effectiveness: 7.8
        },
        {
          id: 4,
          name: "MIT CSAIL Research",
          team: "MIT",
          category: "University",
          eloScore: 2680,
          dateAdded: "2024-01-08",
          complexity: 8.2,
          effectiveness: 8.9
        },
        {
          id: 5,
          name: "Vue.js",
          team: "Evan You",
          category: "Individual",
          eloScore: 2650,
          dateAdded: "2024-01-05",
          complexity: 7.8,
          effectiveness: 9.1
        },
        {
          id: 6,
          name: "D3.js",
          team: "Mike Bostock",
          category: "Individual",
          eloScore: 2620,
          dateAdded: "2024-01-03",
          complexity: 8.9,
          effectiveness: 8.3
        },
        {
          id: 7,
          name: "Stanford AI Lab",
          team: "Stanford University",
          category: "University",
          eloScore: 2590,
          dateAdded: "2024-01-01",
          complexity: 8.5,
          effectiveness: 8.7
        },
        {
          id: 8,
          name: "Rust",
          team: "Mozilla",
          category: "Corporate",
          eloScore: 2560,
          dateAdded: "2023-12-28",
          complexity: 9.3,
          effectiveness: 8.1
        }
      ];
      
      // Simulate network delay
      setTimeout(() => {
        setProjects(mockData);
        setIsLoading(false);
      }, 800);
    };
    
    loadProjects();
  }, []);

  // Calculate ELO score based on complexity and effectiveness
  const calculateEloScore = (complexity, effectiveness) => {
    return Math.round(1500 + (complexity * 100) + (effectiveness * 100));
  };

  // Sort projects
  const sortedProjects = [...projects].sort((a, b) => {
    if (a[sortConfig.key] < b[sortConfig.key]) {
      return sortConfig.direction === 'ascending' ? -1 : 1;
    }
    if (a[sortConfig.key] > b[sortConfig.key]) {
      return sortConfig.direction === 'ascending' ? 1 : -1;
    }
    return 0;
  }).filter(project => filterCategory === 'All' || project.category === filterCategory);

  // Handle sorting
  const requestSort = (key) => {
    let direction = 'ascending';
    if (sortConfig.key === key && sortConfig.direction === 'ascending') {
      direction = 'descending';
    }
    setSortConfig({ key, direction });
  };

  // Handle adding new project
  const handleAddProject = (e) => {
    e.preventDefault();
    if (!newProject.name || !newProject.team) return;
    
    const eloScore = calculateEloScore(newProject.complexity, newProject.effectiveness);
    const project = {
      id: projects.length > 0 ? Math.max(...projects.map(p => p.id)) + 1 : 1,
      ...newProject,
      eloScore,
      dateAdded: new Date().toISOString().split('T')[0]
    };
    
    setProjects([...projects, project]);
    setNewProject({
      name: '',
      team: '',
      category: 'OS Project',
      complexity: 5.0,
      effectiveness: 5.0
    });
  };

  // In a real implementation, you would save to your external data source here
  const handleSaveToExternalSource = async () => {
    // This is where you would implement the connection to Excel Online
    // For example, using Microsoft Graph API or Excel REST API
    alert("In a real implementation, this would save data to your Excel Online spreadsheet");
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500 mx-auto mb-4"></div>
          <p className="text-white text-xl">Loading projects data...</p>
          <p className="text-gray-400 mt-2">In a real implementation, this would connect to your Excel Online spreadsheet</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
      {/* Header */}
      <header className="bg-black bg-opacity-30 backdrop-blur-sm border-b border-purple-500/20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
          <h1 className="text-4xl md:text-5xl font-bold text-white mb-2">
            Finding the best builders.
          </h1>
          <p className="text-xl text-purple-200 mb-6">
            ...and battling against a waste of code
          </p>
          <p className="text-lg text-gray-300 max-w-4xl">
            We create battles of code from across the web against each other to evaluate the best. 
            Using reinforcement learning AI models to score the code across the web. 
            We do it inside companies full-time. And here some part-time initiative for 
            Open Source projects, Universities, Corporate open repos... and suggest your favorite ones below.
          </p>
          <p className="text-md text-gray-400 mt-4">
            It's simple - we adjust complexity and effectiveness of the code.
          </p>
        </div>
      </header>

      {/* Dashboard Section */}
      <section className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-6 mb-8 border border-purple-500/20">
          <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <h2 className="text-3xl font-bold text-white mb-4 md:mb-0">Code Elo Ranking Dashboard</h2>
            <div className="flex space-x-4">
              <select 
                value={filterCategory} 
                onChange={(e) => setFilterCategory(e.target.value)}
                className="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg border border-purple-500/30 focus:outline-none focus:ring-2 focus:ring-purple-500"
              >
                {categories.map(category => (
                  <option key={category} value={category}>{category}</option>
                ))}
              </select>
              <button
                onClick={handleSaveToExternalSource}
                className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors"
              >
                Save to External Source
              </button>
            </div>
          </div>
          
          {projects.length === 0 ? (
            <div className="text-center py-12 text-gray-400">
              <p>No projects found. Add your first project below.</p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="w-full text-white">
                <thead>
                  <tr className="border-b border-purple-500/30">
                    <th 
                      className="text-left py-3 px-4 cursor-pointer hover:text-purple-300 transition-colors"
                      onClick={() => requestSort('name')}
                    >
                      Project {sortConfig.key === 'name' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                    </th>
                    <th 
                      className="text-left py-3 px-4 cursor-pointer hover:text-purple-300 transition-colors"
                      onClick={() => requestSort('team')}
                    >
                      Team {sortConfig.key === 'team' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                    </th>
                    <th 
                      className="text-left py-3 px-4 cursor-pointer hover:text-purple-300 transition-colors"
                      onClick={() => requestSort('category')}
                    >
                      Category {sortConfig.key === 'category' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                    </th>
                    <th 
                      className="text-right py-3 px-4 cursor-pointer hover:text-purple-300 transition-colors"
                      onClick={() => requestSort('eloScore')}
                    >
                      Elo Score {sortConfig.key === 'eloScore' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                    </th>
                    <th 
                      className="text-right py-3 px-4 cursor-pointer hover:text-purple-300 transition-colors"
                      onClick={() => requestSort('complexity')}
                    >
                      Complexity {sortConfig.key === 'complexity' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                    </th>
                    <th 
                      className="text-right py-3 px-4 cursor-pointer hover:text-purple-300 transition-colors"
                      onClick={() => requestSort('effectiveness')}
                    >
                      Effectiveness {sortConfig.key === 'effectiveness' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                    </th>
                    <th 
                      className="text-right py-3 px-4 cursor-pointer hover:text-purple-300 transition-colors"
                      onClick={() => requestSort('dateAdded')}
                    >
                      Added {sortConfig.key === 'dateAdded' && (sortConfig.direction === 'ascending' ? '↑' : '↓')}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {sortedProjects.map((project, index) => (
                    <tr 
                      key={project.id} 
                      className={`border-b border-purple-500/10 hover:bg-white hover:bg-opacity-5 transition-colors ${
                        index < 3 ? 'bg-yellow-500 bg-opacity-20' : ''
                      }`}
                    >
                      <td className="py-4 px-4 font-medium">{project.name}</td>
                      <td className="py-4 px-4">{project.team}</td>
                      <td className="py-4 px-4">
                        <span className={`px-2 py-1 rounded-full text-xs font-semibold ${
                          project.category === 'Corporate' ? 'bg-blue-500 bg-opacity-30 text-blue-200' :
                          project.category === 'University' ? 'bg-green-500 bg-opacity-30 text-green-200' :
                          project.category === 'OS Project' ? 'bg-purple-500 bg-opacity-30 text-purple-200' :
                          'bg-orange-500 bg-opacity-30 text-orange-200'
                        }`}>
                          {project.category}
                        </span>
                      </td>
                      <td className="py-4 px-4 text-right font-bold">{project.eloScore}</td>
                      <td className="py-4 px-4 text-right">{project.complexity.toFixed(1)}</td>
                      <td className="py-4 px-4 text-right">{project.effectiveness.toFixed(1)}</td>
                      <td className="py-4 px-4 text-right">{project.dateAdded}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>

        {/* Add Project Form */}
        <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-6 border border-purple-500/20">
          <h3 className="text-2xl font-bold text-white mb-4">Suggest a Project</h3>
          <form onSubmit={handleAddProject} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <input
              type="text"
              placeholder="Project Name"
              value={newProject.name}
              onChange={(e) => setNewProject({...newProject, name: e.target.value})}
              className="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg border border-purple-500/30 focus:outline-none focus:ring-2 focus:ring-purple-500"
              required
            />
            <input
              type="text"
              placeholder="Team/Organization"
              value={newProject.team}
              onChange={(e) => setNewProject({...newProject, team: e.target.value})}
              className="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg border border-purple-500/30 focus:outline-none focus:ring-2 focus:ring-purple-500"
              required
            />
            <select
              value={newProject.category}
              onChange={(e) => setNewProject({...newProject, category: e.target.value})}
              className="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg border border-purple-500/30 focus:outline-none focus:ring-2 focus:ring-purple-500"
            >
              {categories.slice(1).map(category => (
                <option key={category} value={category}>{category}</option>
              ))}
            </select>
            <input
              type="range"
              min="1"
              max="10"
              step="0.1"
              value={newProject.complexity}
              onChange={(e) => setNewProject({...newProject, complexity: parseFloat(e.target.value)})}
              className="col-span-1 md:col-span-2 lg:col-span-1"
            />
            <span className="text-white">Complexity: {newProject.complexity.toFixed(1)}</span>
            <input
              type="range"
              min="1"
              max="10"
              step="0.1"
              value={newProject.effectiveness}
              onChange={(e) => setNewProject({...newProject, effectiveness: parseFloat(e.target.value)})}
              className="col-span-1 md:col-span-2 lg:col-span-1"
            />
            <span className="text-white">Effectiveness: {newProject.effectiveness.toFixed(1)}</span>
            <button
              type="submit"
              className="col-span-1 md:col-span-2 lg:col-span-3 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors"
            >
              Add Project (Estimated Elo: {calculateEloScore(newProject.complexity, newProject.effectiveness)})
            </button>
          </form>
        </div>
      </section>

      {/* Business Value Section */}
      <section className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-8 text-white text-center">
          <h2 className="text-3xl font-bold mb-4">Company looking to manage development teams?</h2>
          <p className="text-xl mb-6">Tried LORA and many other KPIs frameworks?</p>
          <p className="text-lg mb-8">
            Identify the best in your team - we track both complexity and volume of the code, 
            making it apples-to-apples. Privately compare and ranking across scored databases, 
            and finding the areas to improve.
          </p>
          <button className="bg-white text-purple-600 font-bold py-3 px-8 rounded-lg hover:bg-gray-100 transition-colors">
            Request Enterprise Demo
          </button>
        </div>
      </section>

      {/* Einstein Section */}
      <section className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div className="flex flex-col md:flex-row items-center gap-12">
          <div className="md:w-1/2">
            <img 
              src="https://placehold.co/600x400/4f46e5/ffffff?text=Einstein+Writing+E=mc%C2%B2" 
              alt="Cartoon Einstein writing E=mc² on board" 
              className="rounded-xl shadow-2xl"
            />
          </div>
          <div className="md:w-1/2 text-white">
            <h2 className="text-3xl font-bold mb-6">The Art of Minimal Code</h2>
            <p className="text-lg leading-relaxed">
              Many programmers are describing their daily job as such they've been inventing something, 
              problem-solving for days and finally writing a few lines of code.
            </p>
            <p className="text-lg mt-4 leading-relaxed">
              Our AI engine tries to highlight those "edge cases" - the elegant solutions that solve 
              complex problems with minimal, beautiful code.
            </p>
          </div>
        </div>
      </section>

      {/* Electrician Section */}
      <section className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div className="flex flex-col md:flex-row items-center gap-12">
          <div className="md:w-1/2 text-white order-2 md:order-1">
            <h2 className="text-3xl font-bold mb-6">The Reality of Most Code</h2>
            <p className="text-lg leading-relaxed mb-6">
              ...but the data shows that most deliverables look more like complex electrician output:
            </p>
            <ul className="space-y-3 text-lg">
              <li className="flex items-start">
                <span className="text-purple-400 mr-2">•</span>
                <span>90% of code is copied (which creates vulnerabilities)</span>
              </li>
              <li className="flex items-start">
                <span className="text-purple-400 mr-2">•</span>
                <span>75% of enterprise codebases contain deprecated libraries</span>
              </li>
              <li className="flex items-start">
                <span className="text-purple-400 mr-2">•</span>
                <span>60% of development time is spent on maintenance rather than innovation</span>
              </li>
              <li className="flex items-start">
                <span className="text-purple-400 mr-2">•</span>
                <span>Only 15% of code changes actually improve system performance</span>
              </li>
            </ul>
          </div>
          <div className="md:w-1/2 order-1 md:order-2">
            <img 
              src="https://placehold.co/600x400/dc2626/ffffff?text=Electrician+with+Wires" 
              alt="Electrician figuring out lots of wires" 
              className="rounded-xl shadow-2xl"
            />
          </div>
        </div>
      </section>

      {/* Footer */}
      <footer className="bg-black bg-opacity-30 backdrop-blur-sm border-t border-purple-500/20 mt-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="text-center text-gray-400">
            <p>© 2024 Code Elo Ranking. All rights reserved.</p>
            <p className="mt-2">Powered by Reinforcement Learning AI Models</p>
            <p className="mt-4 text-sm">
              Note: In production, this dashboard would connect to Excel Online or your preferred data source
            </p>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default App;
